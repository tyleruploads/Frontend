<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather</title>
    <style>
        body {
            display: flex;
            margin: 0;
            padding: 20px;
            background-color: rgb(0, 0, 0);
            align-items: center;
            justify-content: flex-start;
        }
        div {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90%; /* Control the width */
            max-width: 800px; /* Max width for readability */
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 8px;

        }
        div h1 {
            color: #0056b3; /* Darker blue for better contrast */
            font-family: Georgia, 'Times New Roman', Times, serif;
            font-size: 2em; /* Smaller size for dates */
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1); /* Fix 4: Correct text-shadow format */
            margin-top: 20px;
            margin-bottom: 5px;
        }
        li {
            list-style-type: none; /* Remove bullet points */
            padding: 0;
            width: 100%; /* Make list take full width of container */
            max-width: 400px; /* Optional: Constrain list width for narrow entries */
            text-align: center;
            color: rgb(255, 255, 255)
        }
    </style>
</head>
<body>
    <div id="weather-output"></div>
</body>
<script>
    const LATITUDE = 0; 
    const LONGITUDE = 0;
    const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${LATITUDE}&longitude=${LONGITUDE}&hourly=temperature_2m&temperature_unit=fahrenheit&timezone=America%2FNew_York`

    const weatherOutput = document.getElementById('weather-output')

    const timeOptions = {
    hour: 'numeric', // This will output just the hour
    hour12: true 
    };

    fetch(apiUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error("Response was not ok")
            }
            return response.json()
        })
        .then(data => {
            console.log('Weather Data: ', data)

            const temps = data.hourly.temperature_2m
            const times = data.hourly.time

            let outputHTML = ""
            let currentDay = null

            for (let i=0; i < temps.length; i++) {
                const dateTime = new Date(times[i])
                const temp = temps[i]

                const dateString = dateTime.toLocaleDateString()

                if (dateString !== currentDay) {
                    currentDay = dateString
                    const headerDate = dateTime.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })
                    outputHTML += `<h1>${headerDate}</h1>`
                    outputHTML += `<ul>`
                }

                if (currentDay !== null) {
                    outputHTML += "\</ul\>"; 
                }

                outputHTML += `<li>${dateTime.toLocaleTimeString('en-US', timeOptions)}: ${temp}Â°F</li>`

                if (i === Math.min(temps.length, 168) -1 || new Date(times[i + 1]).toLocaleDateString() !== dateString) {
                    outputHTML += "</ul>"
                }
            }
            weatherOutput.innerHTML = outputHTML
        })
        .catch(error => {
            console.error('There was an error in the fetch: ', error)
            weatherOutput.innerHTML = `<p style="color: red;">Error loading weather data: ${error.message}</p>`
        })

</script>
</html>